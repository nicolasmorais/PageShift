version: '3.8'

services:
  web:
    # Replace 'your-github-username/your-repo-name' with the actual image path from GHCR.
    # Users will need to update this to their own image after building with GitHub Actions.
    image: ghcr.io/your-github-username/your-repo-name:latest
    container_name: dyad-app-web

    # Allows for port change: Maps container port 3000 (where Next.js runs)
    # to host port 3000. Users can change the host port (e.g., "8080:3000").
    ports:
      - "3000:3000"

    # Maps a directory to keep the JSON DB file (for persistence).
    # This creates a named volume for persistent data storage,
    # or you can map a host path (e.g., "./data:/app/data").
    volumes:
      - dyad_db_data:/app/data

    # Optionally sets environment variables.
    # These override any ENVs set in the Dockerfile.
    environment:
      NODE_ENV: production
      # Set the DATABASE_DIR to match the volume mapping
      DATABASE_DIR: /app/data

    # Restart policy for the container
    restart: unless-stopped

# Define the named volumes used by the services
volumes:
  dyad_db_data:
    # Driver can be local (default), or other options like 'azure_file', 'gcp_gcs_fuse' etc.
    # For local development, 'local' is sufficient.